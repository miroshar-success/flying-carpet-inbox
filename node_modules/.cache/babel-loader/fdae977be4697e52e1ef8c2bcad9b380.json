{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * \n * @emails oncall+draft_js\n */\n'use strict';\n\nvar DataTransfer = require(\"fbjs/lib/DataTransfer\");\n\nvar DraftModifier = require(\"./DraftModifier\");\n\nvar EditorState = require(\"./EditorState\");\n\nvar findAncestorOffsetKey = require(\"./findAncestorOffsetKey\");\n\nvar getCorrectDocumentFromNode = require(\"./getCorrectDocumentFromNode\");\n\nvar getTextContentFromFiles = require(\"./getTextContentFromFiles\");\n\nvar getUpdatedSelectionState = require(\"./getUpdatedSelectionState\");\n\nvar getWindowForNode = require(\"./getWindowForNode\");\n\nvar isEventHandled = require(\"./isEventHandled\");\n\nvar nullthrows = require(\"fbjs/lib/nullthrows\");\n/**\n * Get a SelectionState for the supplied mouse event.\n */\n\n\nfunction getSelectionForEvent(event, editorState) {\n  var node = null;\n  var offset = null;\n  var eventTargetDocument = getCorrectDocumentFromNode(event.currentTarget);\n  /* $FlowFixMe[prop-missing] (>=0.68.0 site=www,mobile) This comment\n   * suppresses an error found when Flow v0.68 was deployed. To see the error\n   * delete this comment and run Flow. */\n\n  if (typeof eventTargetDocument.caretRangeFromPoint === 'function') {\n    /* $FlowFixMe[incompatible-use] (>=0.68.0 site=www,mobile) This comment\n     * suppresses an error found when Flow v0.68 was deployed. To see the error\n     * delete this comment and run Flow. */\n    var dropRange = eventTargetDocument.caretRangeFromPoint(event.x, event.y);\n    node = dropRange.startContainer;\n    offset = dropRange.startOffset;\n  } else if (event.rangeParent) {\n    node = event.rangeParent;\n    offset = event.rangeOffset;\n  } else {\n    return null;\n  }\n\n  node = nullthrows(node);\n  offset = nullthrows(offset);\n  var offsetKey = nullthrows(findAncestorOffsetKey(node));\n  return getUpdatedSelectionState(editorState, offsetKey, offset, offsetKey, offset);\n}\n\nvar DraftEditorDragHandler = {\n  /**\n   * Drag originating from input terminated.\n   */\n  onDragEnd: function onDragEnd(editor) {\n    editor.exitCurrentMode();\n    endDrag(editor);\n  },\n\n  /**\n   * Handle data being dropped.\n   */\n  onDrop: function onDrop(editor, e) {\n    var data = new DataTransfer(e.nativeEvent.dataTransfer);\n    var editorState = editor._latestEditorState;\n    var dropSelection = getSelectionForEvent(e.nativeEvent, editorState);\n    e.preventDefault();\n    editor._dragCount = 0;\n    editor.exitCurrentMode();\n\n    if (dropSelection == null) {\n      return;\n    }\n\n    var files = data.getFiles();\n\n    if (files.length > 0) {\n      if (editor.props.handleDroppedFiles && isEventHandled(editor.props.handleDroppedFiles(dropSelection, files))) {\n        return;\n      }\n      /* $FlowFixMe[incompatible-call] This comment suppresses an error found\n       * DataTransfer was typed. getFiles() returns an array of <Files extends\n       * Blob>, not Blob */\n\n\n      getTextContentFromFiles(files, function (fileText) {\n        fileText && editor.update(insertTextAtSelection(editorState, dropSelection, fileText));\n      });\n      return;\n    }\n\n    var dragType = editor._internalDrag ? 'internal' : 'external';\n\n    if (editor.props.handleDrop && isEventHandled(editor.props.handleDrop(dropSelection, data, dragType))) {// handled\n    } else if (editor._internalDrag) {\n      editor.update(moveText(editorState, dropSelection));\n    } else {\n      editor.update(insertTextAtSelection(editorState, dropSelection, data.getText()));\n    }\n\n    endDrag(editor);\n  }\n};\n\nfunction endDrag(editor) {\n  editor._internalDrag = false; // Fix issue #1383\n  // Prior to React v16.5.0 onDrop breaks onSelect event:\n  // https://github.com/facebook/react/issues/11379.\n  // Dispatching a mouseup event on DOM node will make it go back to normal.\n\n  var editorNode = editor.editorContainer;\n\n  if (editorNode) {\n    var mouseUpEvent = new MouseEvent('mouseup', {\n      view: getWindowForNode(editorNode),\n      bubbles: true,\n      cancelable: true\n    });\n    editorNode.dispatchEvent(mouseUpEvent);\n  }\n}\n\nfunction moveText(editorState, targetSelection) {\n  var newContentState = DraftModifier.moveText(editorState.getCurrentContent(), editorState.getSelection(), targetSelection);\n  return EditorState.push(editorState, newContentState, 'insert-fragment');\n}\n/**\n * Insert text at a specified selection.\n */\n\n\nfunction insertTextAtSelection(editorState, selection, text) {\n  var newContentState = DraftModifier.insertText(editorState.getCurrentContent(), selection, text, editorState.getCurrentInlineStyle());\n  return EditorState.push(editorState, newContentState, 'insert-fragment');\n}\n\nmodule.exports = DraftEditorDragHandler;","map":{"version":3,"sources":["D:/workspace/flyingcarpet/flyingcarpet-shared-inbox/node_modules/draft-js/lib/DraftEditorDragHandler.js"],"names":["DataTransfer","require","DraftModifier","EditorState","findAncestorOffsetKey","getCorrectDocumentFromNode","getTextContentFromFiles","getUpdatedSelectionState","getWindowForNode","isEventHandled","nullthrows","getSelectionForEvent","event","editorState","node","offset","eventTargetDocument","currentTarget","caretRangeFromPoint","dropRange","x","y","startContainer","startOffset","rangeParent","rangeOffset","offsetKey","DraftEditorDragHandler","onDragEnd","editor","exitCurrentMode","endDrag","onDrop","e","data","nativeEvent","dataTransfer","_latestEditorState","dropSelection","preventDefault","_dragCount","files","getFiles","length","props","handleDroppedFiles","fileText","update","insertTextAtSelection","dragType","_internalDrag","handleDrop","moveText","getText","editorNode","editorContainer","mouseUpEvent","MouseEvent","view","bubbles","cancelable","dispatchEvent","targetSelection","newContentState","getCurrentContent","getSelection","push","selection","text","insertText","getCurrentInlineStyle","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * \n * @emails oncall+draft_js\n */\n'use strict';\n\nvar DataTransfer = require(\"fbjs/lib/DataTransfer\");\n\nvar DraftModifier = require(\"./DraftModifier\");\n\nvar EditorState = require(\"./EditorState\");\n\nvar findAncestorOffsetKey = require(\"./findAncestorOffsetKey\");\n\nvar getCorrectDocumentFromNode = require(\"./getCorrectDocumentFromNode\");\n\nvar getTextContentFromFiles = require(\"./getTextContentFromFiles\");\n\nvar getUpdatedSelectionState = require(\"./getUpdatedSelectionState\");\n\nvar getWindowForNode = require(\"./getWindowForNode\");\n\nvar isEventHandled = require(\"./isEventHandled\");\n\nvar nullthrows = require(\"fbjs/lib/nullthrows\");\n/**\n * Get a SelectionState for the supplied mouse event.\n */\n\n\nfunction getSelectionForEvent(event, editorState) {\n  var node = null;\n  var offset = null;\n  var eventTargetDocument = getCorrectDocumentFromNode(event.currentTarget);\n  /* $FlowFixMe[prop-missing] (>=0.68.0 site=www,mobile) This comment\n   * suppresses an error found when Flow v0.68 was deployed. To see the error\n   * delete this comment and run Flow. */\n\n  if (typeof eventTargetDocument.caretRangeFromPoint === 'function') {\n    /* $FlowFixMe[incompatible-use] (>=0.68.0 site=www,mobile) This comment\n     * suppresses an error found when Flow v0.68 was deployed. To see the error\n     * delete this comment and run Flow. */\n    var dropRange = eventTargetDocument.caretRangeFromPoint(event.x, event.y);\n    node = dropRange.startContainer;\n    offset = dropRange.startOffset;\n  } else if (event.rangeParent) {\n    node = event.rangeParent;\n    offset = event.rangeOffset;\n  } else {\n    return null;\n  }\n\n  node = nullthrows(node);\n  offset = nullthrows(offset);\n  var offsetKey = nullthrows(findAncestorOffsetKey(node));\n  return getUpdatedSelectionState(editorState, offsetKey, offset, offsetKey, offset);\n}\n\nvar DraftEditorDragHandler = {\n  /**\n   * Drag originating from input terminated.\n   */\n  onDragEnd: function onDragEnd(editor) {\n    editor.exitCurrentMode();\n    endDrag(editor);\n  },\n\n  /**\n   * Handle data being dropped.\n   */\n  onDrop: function onDrop(editor, e) {\n    var data = new DataTransfer(e.nativeEvent.dataTransfer);\n    var editorState = editor._latestEditorState;\n    var dropSelection = getSelectionForEvent(e.nativeEvent, editorState);\n    e.preventDefault();\n    editor._dragCount = 0;\n    editor.exitCurrentMode();\n\n    if (dropSelection == null) {\n      return;\n    }\n\n    var files = data.getFiles();\n\n    if (files.length > 0) {\n      if (editor.props.handleDroppedFiles && isEventHandled(editor.props.handleDroppedFiles(dropSelection, files))) {\n        return;\n      }\n      /* $FlowFixMe[incompatible-call] This comment suppresses an error found\n       * DataTransfer was typed. getFiles() returns an array of <Files extends\n       * Blob>, not Blob */\n\n\n      getTextContentFromFiles(files, function (fileText) {\n        fileText && editor.update(insertTextAtSelection(editorState, dropSelection, fileText));\n      });\n      return;\n    }\n\n    var dragType = editor._internalDrag ? 'internal' : 'external';\n\n    if (editor.props.handleDrop && isEventHandled(editor.props.handleDrop(dropSelection, data, dragType))) {// handled\n    } else if (editor._internalDrag) {\n      editor.update(moveText(editorState, dropSelection));\n    } else {\n      editor.update(insertTextAtSelection(editorState, dropSelection, data.getText()));\n    }\n\n    endDrag(editor);\n  }\n};\n\nfunction endDrag(editor) {\n  editor._internalDrag = false; // Fix issue #1383\n  // Prior to React v16.5.0 onDrop breaks onSelect event:\n  // https://github.com/facebook/react/issues/11379.\n  // Dispatching a mouseup event on DOM node will make it go back to normal.\n\n  var editorNode = editor.editorContainer;\n\n  if (editorNode) {\n    var mouseUpEvent = new MouseEvent('mouseup', {\n      view: getWindowForNode(editorNode),\n      bubbles: true,\n      cancelable: true\n    });\n    editorNode.dispatchEvent(mouseUpEvent);\n  }\n}\n\nfunction moveText(editorState, targetSelection) {\n  var newContentState = DraftModifier.moveText(editorState.getCurrentContent(), editorState.getSelection(), targetSelection);\n  return EditorState.push(editorState, newContentState, 'insert-fragment');\n}\n/**\n * Insert text at a specified selection.\n */\n\n\nfunction insertTextAtSelection(editorState, selection, text) {\n  var newContentState = DraftModifier.insertText(editorState.getCurrentContent(), selection, text, editorState.getCurrentInlineStyle());\n  return EditorState.push(editorState, newContentState, 'insert-fragment');\n}\n\nmodule.exports = DraftEditorDragHandler;"]},"metadata":{},"sourceType":"script"}