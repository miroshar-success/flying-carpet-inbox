{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * \n * @emails oncall+draft_js\n */\n'use strict';\n\nvar DraftEffects = require(\"./DraftEffects\");\n\nvar DraftJsDebugLogging = require(\"./DraftJsDebugLogging\");\n\nvar UserAgent = require(\"fbjs/lib/UserAgent\");\n\nvar containsNode = require(\"fbjs/lib/containsNode\");\n\nvar getActiveElement = require(\"fbjs/lib/getActiveElement\");\n\nvar getCorrectDocumentFromNode = require(\"./getCorrectDocumentFromNode\");\n\nvar invariant = require(\"fbjs/lib/invariant\");\n\nvar isElement = require(\"./isElement\");\n\nvar isIE = UserAgent.isBrowser('IE');\n\nfunction getAnonymizedDOM(node, getNodeLabels) {\n  if (!node) {\n    return '[empty]';\n  }\n\n  var anonymized = anonymizeTextWithin(node, getNodeLabels);\n\n  if (anonymized.nodeType === Node.TEXT_NODE) {\n    return anonymized.textContent;\n  }\n\n  !isElement(anonymized) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Node must be an Element if it is not a text node.') : invariant(false) : void 0;\n  var castedElement = anonymized;\n  return castedElement.outerHTML;\n}\n\nfunction anonymizeTextWithin(node, getNodeLabels) {\n  var labels = getNodeLabels !== undefined ? getNodeLabels(node) : [];\n\n  if (node.nodeType === Node.TEXT_NODE) {\n    var length = node.textContent.length;\n    return getCorrectDocumentFromNode(node).createTextNode('[text ' + length + (labels.length ? ' | ' + labels.join(', ') : '') + ']');\n  }\n\n  var clone = node.cloneNode();\n\n  if (clone.nodeType === 1 && labels.length) {\n    clone.setAttribute('data-labels', labels.join(', '));\n  }\n\n  var childNodes = node.childNodes;\n\n  for (var ii = 0; ii < childNodes.length; ii++) {\n    clone.appendChild(anonymizeTextWithin(childNodes[ii], getNodeLabels));\n  }\n\n  return clone;\n}\n\nfunction getAnonymizedEditorDOM(node, getNodeLabels) {\n  // grabbing the DOM content of the Draft editor\n  var currentNode = node; // this should only be used after checking with isElement\n\n  var castedNode = currentNode;\n\n  while (currentNode) {\n    if (isElement(currentNode) && castedNode.hasAttribute('contenteditable')) {\n      // found the Draft editor container\n      return getAnonymizedDOM(currentNode, getNodeLabels);\n    } else {\n      currentNode = currentNode.parentNode;\n      castedNode = currentNode;\n    }\n  }\n\n  return 'Could not find contentEditable parent of node';\n}\n\nfunction getNodeLength(node) {\n  return node.nodeValue === null ? node.childNodes.length : node.nodeValue.length;\n}\n/**\n * In modern non-IE browsers, we can support both forward and backward\n * selections.\n *\n * Note: IE10+ supports the Selection object, but it does not support\n * the `extend` method, which means that even in modern IE, it's not possible\n * to programatically create a backward selection. Thus, for all IE\n * versions, we use the old IE API to create our selections.\n */\n\n\nfunction setDraftEditorSelection(selectionState, node, blockKey, nodeStart, nodeEnd) {\n  // It's possible that the editor has been removed from the DOM but\n  // our selection code doesn't know it yet. Forcing selection in\n  // this case may lead to errors, so just bail now.\n  var documentObject = getCorrectDocumentFromNode(node);\n\n  if (!containsNode(documentObject.documentElement, node)) {\n    return;\n  }\n\n  var selection = documentObject.defaultView.getSelection();\n  var anchorKey = selectionState.getAnchorKey();\n  var anchorOffset = selectionState.getAnchorOffset();\n  var focusKey = selectionState.getFocusKey();\n  var focusOffset = selectionState.getFocusOffset();\n  var isBackward = selectionState.getIsBackward(); // IE doesn't support backward selection. Swap key/offset pairs.\n\n  if (!selection.extend && isBackward) {\n    var tempKey = anchorKey;\n    var tempOffset = anchorOffset;\n    anchorKey = focusKey;\n    anchorOffset = focusOffset;\n    focusKey = tempKey;\n    focusOffset = tempOffset;\n    isBackward = false;\n  }\n\n  var hasAnchor = anchorKey === blockKey && nodeStart <= anchorOffset && nodeEnd >= anchorOffset;\n  var hasFocus = focusKey === blockKey && nodeStart <= focusOffset && nodeEnd >= focusOffset; // If the selection is entirely bound within this node, set the selection\n  // and be done.\n\n  if (hasAnchor && hasFocus) {\n    selection.removeAllRanges();\n    addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n    addFocusToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    return;\n  }\n\n  if (!isBackward) {\n    // If the anchor is within this node, set the range start.\n    if (hasAnchor) {\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n    } // If the focus is within this node, we can assume that we have\n    // already set the appropriate start range on the selection, and\n    // can simply extend the selection.\n\n\n    if (hasFocus) {\n      addFocusToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    }\n  } else {\n    // If this node has the focus, set the selection range to be a\n    // collapsed range beginning here. Later, when we encounter the anchor,\n    // we'll use this information to extend the selection.\n    if (hasFocus) {\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    } // If this node has the anchor, we may assume that the correct\n    // focus information is already stored on the selection object.\n    // We keep track of it, reset the selection range, and extend it\n    // back to the focus point.\n\n\n    if (hasAnchor) {\n      var storedFocusNode = selection.focusNode;\n      var storedFocusOffset = selection.focusOffset;\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n      addFocusToSelection(selection, storedFocusNode, storedFocusOffset, selectionState);\n    }\n  }\n}\n/**\n * Extend selection towards focus point.\n */\n\n\nfunction addFocusToSelection(selection, node, offset, selectionState) {\n  var activeElement = getActiveElement();\n  var extend = selection.extend; // containsNode returns false if node is null.\n  // Let's refine the type of this value out here so flow knows.\n\n  if (extend && node != null && containsNode(activeElement, node)) {\n    // If `extend` is called while another element has focus, an error is\n    // thrown. We therefore disable `extend` if the active element is somewhere\n    // other than the node we are selecting. This should only occur in Firefox,\n    // since it is the only browser to support multiple selections.\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=921444.\n    // logging to catch bug that is being reported in t16250795\n    if (offset > getNodeLength(node)) {\n      // the call to 'selection.extend' is about to throw\n      DraftJsDebugLogging.logSelectionStateFailure({\n        anonymizedDom: getAnonymizedEditorDOM(node),\n        extraParams: JSON.stringify({\n          offset: offset\n        }),\n        selectionState: JSON.stringify(selectionState.toJS())\n      });\n    } // logging to catch bug that is being reported in t18110632\n\n\n    var nodeWasFocus = node === selection.focusNode;\n\n    try {\n      // Fixes some reports of \"InvalidStateError: Failed to execute 'extend' on\n      // 'Selection': This Selection object doesn't have any Ranges.\"\n      // Note: selection.extend does not exist in IE.\n      if (selection.rangeCount > 0 && selection.extend) {\n        selection.extend(node, offset);\n      }\n    } catch (e) {\n      DraftJsDebugLogging.logSelectionStateFailure({\n        anonymizedDom: getAnonymizedEditorDOM(node, function (n) {\n          var labels = [];\n\n          if (n === activeElement) {\n            labels.push('active element');\n          }\n\n          if (n === selection.anchorNode) {\n            labels.push('selection anchor node');\n          }\n\n          if (n === selection.focusNode) {\n            labels.push('selection focus node');\n          }\n\n          return labels;\n        }),\n        extraParams: JSON.stringify({\n          activeElementName: activeElement ? activeElement.nodeName : null,\n          nodeIsFocus: node === selection.focusNode,\n          nodeWasFocus: nodeWasFocus,\n          selectionRangeCount: selection.rangeCount,\n          selectionAnchorNodeName: selection.anchorNode ? selection.anchorNode.nodeName : null,\n          selectionAnchorOffset: selection.anchorOffset,\n          selectionFocusNodeName: selection.focusNode ? selection.focusNode.nodeName : null,\n          selectionFocusOffset: selection.focusOffset,\n          message: e ? '' + e : null,\n          offset: offset\n        }, null, 2),\n        selectionState: JSON.stringify(selectionState.toJS(), null, 2)\n      }); // allow the error to be thrown -\n      // better than continuing in a broken state\n\n      throw e;\n    }\n  } else {\n    // IE doesn't support extend. This will mean no backward selection.\n    // Extract the existing selection range and add focus to it.\n    // Additionally, clone the selection range. IE11 throws an\n    // InvalidStateError when attempting to access selection properties\n    // after the range is detached.\n    if (node && selection.rangeCount > 0) {\n      var range = selection.getRangeAt(0);\n      range.setEnd(node, offset);\n      selection.addRange(range.cloneRange());\n    }\n  }\n}\n\nfunction addPointToSelection(selection, node, offset, selectionState) {\n  var range = getCorrectDocumentFromNode(node).createRange(); // logging to catch bug that is being reported in t16250795\n\n  if (offset > getNodeLength(node)) {\n    // in this case we know that the call to 'range.setStart' is about to throw\n    DraftJsDebugLogging.logSelectionStateFailure({\n      anonymizedDom: getAnonymizedEditorDOM(node),\n      extraParams: JSON.stringify({\n        offset: offset\n      }),\n      selectionState: JSON.stringify(selectionState.toJS())\n    });\n    DraftEffects.handleExtensionCausedError();\n  }\n\n  range.setStart(node, offset); // IE sometimes throws Unspecified Error when trying to addRange\n\n  if (isIE) {\n    try {\n      selection.addRange(range);\n    } catch (e) {\n      if (process.env.NODE_ENV !== \"production\") {\n        /* eslint-disable-next-line no-console */\n        console.warn('Call to selection.addRange() threw exception: ', e);\n      }\n    }\n  } else {\n    selection.addRange(range);\n  }\n}\n\nmodule.exports = {\n  setDraftEditorSelection: setDraftEditorSelection,\n  addFocusToSelection: addFocusToSelection\n};","map":{"version":3,"sources":["D:/workspace/flying-assess/flyingcarpet-shared-inbox/node_modules/draft-js/lib/setDraftEditorSelection.js"],"names":["DraftEffects","require","DraftJsDebugLogging","UserAgent","containsNode","getActiveElement","getCorrectDocumentFromNode","invariant","isElement","isIE","isBrowser","getAnonymizedDOM","node","getNodeLabels","anonymized","anonymizeTextWithin","nodeType","Node","TEXT_NODE","textContent","process","env","NODE_ENV","castedElement","outerHTML","labels","undefined","length","createTextNode","join","clone","cloneNode","setAttribute","childNodes","ii","appendChild","getAnonymizedEditorDOM","currentNode","castedNode","hasAttribute","parentNode","getNodeLength","nodeValue","setDraftEditorSelection","selectionState","blockKey","nodeStart","nodeEnd","documentObject","documentElement","selection","defaultView","getSelection","anchorKey","getAnchorKey","anchorOffset","getAnchorOffset","focusKey","getFocusKey","focusOffset","getFocusOffset","isBackward","getIsBackward","extend","tempKey","tempOffset","hasAnchor","hasFocus","removeAllRanges","addPointToSelection","addFocusToSelection","storedFocusNode","focusNode","storedFocusOffset","offset","activeElement","logSelectionStateFailure","anonymizedDom","extraParams","JSON","stringify","toJS","nodeWasFocus","rangeCount","e","n","push","anchorNode","activeElementName","nodeName","nodeIsFocus","selectionRangeCount","selectionAnchorNodeName","selectionAnchorOffset","selectionFocusNodeName","selectionFocusOffset","message","range","getRangeAt","setEnd","addRange","cloneRange","createRange","handleExtensionCausedError","setStart","console","warn","module","exports"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,YAAY,GAAGC,OAAO,CAAC,gBAAD,CAA1B;;AAEA,IAAIC,mBAAmB,GAAGD,OAAO,CAAC,uBAAD,CAAjC;;AAEA,IAAIE,SAAS,GAAGF,OAAO,CAAC,oBAAD,CAAvB;;AAEA,IAAIG,YAAY,GAAGH,OAAO,CAAC,uBAAD,CAA1B;;AAEA,IAAII,gBAAgB,GAAGJ,OAAO,CAAC,2BAAD,CAA9B;;AAEA,IAAIK,0BAA0B,GAAGL,OAAO,CAAC,8BAAD,CAAxC;;AAEA,IAAIM,SAAS,GAAGN,OAAO,CAAC,oBAAD,CAAvB;;AAEA,IAAIO,SAAS,GAAGP,OAAO,CAAC,aAAD,CAAvB;;AAEA,IAAIQ,IAAI,GAAGN,SAAS,CAACO,SAAV,CAAoB,IAApB,CAAX;;AAEA,SAASC,gBAAT,CAA0BC,IAA1B,EAAgCC,aAAhC,EAA+C;AAC7C,MAAI,CAACD,IAAL,EAAW;AACT,WAAO,SAAP;AACD;;AAED,MAAIE,UAAU,GAAGC,mBAAmB,CAACH,IAAD,EAAOC,aAAP,CAApC;;AAEA,MAAIC,UAAU,CAACE,QAAX,KAAwBC,IAAI,CAACC,SAAjC,EAA4C;AAC1C,WAAOJ,UAAU,CAACK,WAAlB;AACD;;AAED,GAACX,SAAS,CAACM,UAAD,CAAV,GAAyBM,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwCf,SAAS,CAAC,KAAD,EAAQ,mDAAR,CAAjD,GAAgHA,SAAS,CAAC,KAAD,CAAlJ,GAA4J,KAAK,CAAjK;AACA,MAAIgB,aAAa,GAAGT,UAApB;AACA,SAAOS,aAAa,CAACC,SAArB;AACD;;AAED,SAAST,mBAAT,CAA6BH,IAA7B,EAAmCC,aAAnC,EAAkD;AAChD,MAAIY,MAAM,GAAGZ,aAAa,KAAKa,SAAlB,GAA8Bb,aAAa,CAACD,IAAD,CAA3C,GAAoD,EAAjE;;AAEA,MAAIA,IAAI,CAACI,QAAL,KAAkBC,IAAI,CAACC,SAA3B,EAAsC;AACpC,QAAIS,MAAM,GAAGf,IAAI,CAACO,WAAL,CAAiBQ,MAA9B;AACA,WAAOrB,0BAA0B,CAACM,IAAD,CAA1B,CAAiCgB,cAAjC,CAAgD,WAAWD,MAAX,IAAqBF,MAAM,CAACE,MAAP,GAAgB,QAAQF,MAAM,CAACI,IAAP,CAAY,IAAZ,CAAxB,GAA4C,EAAjE,IAAuE,GAAvH,CAAP;AACD;;AAED,MAAIC,KAAK,GAAGlB,IAAI,CAACmB,SAAL,EAAZ;;AAEA,MAAID,KAAK,CAACd,QAAN,KAAmB,CAAnB,IAAwBS,MAAM,CAACE,MAAnC,EAA2C;AACzCG,IAAAA,KAAK,CAACE,YAAN,CAAmB,aAAnB,EAAkCP,MAAM,CAACI,IAAP,CAAY,IAAZ,CAAlC;AACD;;AAED,MAAII,UAAU,GAAGrB,IAAI,CAACqB,UAAtB;;AAEA,OAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGD,UAAU,CAACN,MAAjC,EAAyCO,EAAE,EAA3C,EAA+C;AAC7CJ,IAAAA,KAAK,CAACK,WAAN,CAAkBpB,mBAAmB,CAACkB,UAAU,CAACC,EAAD,CAAX,EAAiBrB,aAAjB,CAArC;AACD;;AAED,SAAOiB,KAAP;AACD;;AAED,SAASM,sBAAT,CAAgCxB,IAAhC,EAAsCC,aAAtC,EAAqD;AACnD;AACA,MAAIwB,WAAW,GAAGzB,IAAlB,CAFmD,CAE3B;;AAExB,MAAI0B,UAAU,GAAGD,WAAjB;;AAEA,SAAOA,WAAP,EAAoB;AAClB,QAAI7B,SAAS,CAAC6B,WAAD,CAAT,IAA0BC,UAAU,CAACC,YAAX,CAAwB,iBAAxB,CAA9B,EAA0E;AACxE;AACA,aAAO5B,gBAAgB,CAAC0B,WAAD,EAAcxB,aAAd,CAAvB;AACD,KAHD,MAGO;AACLwB,MAAAA,WAAW,GAAGA,WAAW,CAACG,UAA1B;AACAF,MAAAA,UAAU,GAAGD,WAAb;AACD;AACF;;AAED,SAAO,+CAAP;AACD;;AAED,SAASI,aAAT,CAAuB7B,IAAvB,EAA6B;AAC3B,SAAOA,IAAI,CAAC8B,SAAL,KAAmB,IAAnB,GAA0B9B,IAAI,CAACqB,UAAL,CAAgBN,MAA1C,GAAmDf,IAAI,CAAC8B,SAAL,CAAef,MAAzE;AACD;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,SAASgB,uBAAT,CAAiCC,cAAjC,EAAiDhC,IAAjD,EAAuDiC,QAAvD,EAAiEC,SAAjE,EAA4EC,OAA5E,EAAqF;AACnF;AACA;AACA;AACA,MAAIC,cAAc,GAAG1C,0BAA0B,CAACM,IAAD,CAA/C;;AAEA,MAAI,CAACR,YAAY,CAAC4C,cAAc,CAACC,eAAhB,EAAiCrC,IAAjC,CAAjB,EAAyD;AACvD;AACD;;AAED,MAAIsC,SAAS,GAAGF,cAAc,CAACG,WAAf,CAA2BC,YAA3B,EAAhB;AACA,MAAIC,SAAS,GAAGT,cAAc,CAACU,YAAf,EAAhB;AACA,MAAIC,YAAY,GAAGX,cAAc,CAACY,eAAf,EAAnB;AACA,MAAIC,QAAQ,GAAGb,cAAc,CAACc,WAAf,EAAf;AACA,MAAIC,WAAW,GAAGf,cAAc,CAACgB,cAAf,EAAlB;AACA,MAAIC,UAAU,GAAGjB,cAAc,CAACkB,aAAf,EAAjB,CAfmF,CAelC;;AAEjD,MAAI,CAACZ,SAAS,CAACa,MAAX,IAAqBF,UAAzB,EAAqC;AACnC,QAAIG,OAAO,GAAGX,SAAd;AACA,QAAIY,UAAU,GAAGV,YAAjB;AACAF,IAAAA,SAAS,GAAGI,QAAZ;AACAF,IAAAA,YAAY,GAAGI,WAAf;AACAF,IAAAA,QAAQ,GAAGO,OAAX;AACAL,IAAAA,WAAW,GAAGM,UAAd;AACAJ,IAAAA,UAAU,GAAG,KAAb;AACD;;AAED,MAAIK,SAAS,GAAGb,SAAS,KAAKR,QAAd,IAA0BC,SAAS,IAAIS,YAAvC,IAAuDR,OAAO,IAAIQ,YAAlF;AACA,MAAIY,QAAQ,GAAGV,QAAQ,KAAKZ,QAAb,IAAyBC,SAAS,IAAIa,WAAtC,IAAqDZ,OAAO,IAAIY,WAA/E,CA5BmF,CA4BS;AAC5F;;AAEA,MAAIO,SAAS,IAAIC,QAAjB,EAA2B;AACzBjB,IAAAA,SAAS,CAACkB,eAAV;AACAC,IAAAA,mBAAmB,CAACnB,SAAD,EAAYtC,IAAZ,EAAkB2C,YAAY,GAAGT,SAAjC,EAA4CF,cAA5C,CAAnB;AACA0B,IAAAA,mBAAmB,CAACpB,SAAD,EAAYtC,IAAZ,EAAkB+C,WAAW,GAAGb,SAAhC,EAA2CF,cAA3C,CAAnB;AACA;AACD;;AAED,MAAI,CAACiB,UAAL,EAAiB;AACf;AACA,QAAIK,SAAJ,EAAe;AACbhB,MAAAA,SAAS,CAACkB,eAAV;AACAC,MAAAA,mBAAmB,CAACnB,SAAD,EAAYtC,IAAZ,EAAkB2C,YAAY,GAAGT,SAAjC,EAA4CF,cAA5C,CAAnB;AACD,KALc,CAKb;AACF;AACA;;;AAGA,QAAIuB,QAAJ,EAAc;AACZG,MAAAA,mBAAmB,CAACpB,SAAD,EAAYtC,IAAZ,EAAkB+C,WAAW,GAAGb,SAAhC,EAA2CF,cAA3C,CAAnB;AACD;AACF,GAbD,MAaO;AACL;AACA;AACA;AACA,QAAIuB,QAAJ,EAAc;AACZjB,MAAAA,SAAS,CAACkB,eAAV;AACAC,MAAAA,mBAAmB,CAACnB,SAAD,EAAYtC,IAAZ,EAAkB+C,WAAW,GAAGb,SAAhC,EAA2CF,cAA3C,CAAnB;AACD,KAPI,CAOH;AACF;AACA;AACA;;;AAGA,QAAIsB,SAAJ,EAAe;AACb,UAAIK,eAAe,GAAGrB,SAAS,CAACsB,SAAhC;AACA,UAAIC,iBAAiB,GAAGvB,SAAS,CAACS,WAAlC;AACAT,MAAAA,SAAS,CAACkB,eAAV;AACAC,MAAAA,mBAAmB,CAACnB,SAAD,EAAYtC,IAAZ,EAAkB2C,YAAY,GAAGT,SAAjC,EAA4CF,cAA5C,CAAnB;AACA0B,MAAAA,mBAAmB,CAACpB,SAAD,EAAYqB,eAAZ,EAA6BE,iBAA7B,EAAgD7B,cAAhD,CAAnB;AACD;AACF;AACF;AACD;AACA;AACA;;;AAGA,SAAS0B,mBAAT,CAA6BpB,SAA7B,EAAwCtC,IAAxC,EAA8C8D,MAA9C,EAAsD9B,cAAtD,EAAsE;AACpE,MAAI+B,aAAa,GAAGtE,gBAAgB,EAApC;AACA,MAAI0D,MAAM,GAAGb,SAAS,CAACa,MAAvB,CAFoE,CAErC;AAC/B;;AAEA,MAAIA,MAAM,IAAInD,IAAI,IAAI,IAAlB,IAA0BR,YAAY,CAACuE,aAAD,EAAgB/D,IAAhB,CAA1C,EAAiE;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA,QAAI8D,MAAM,GAAGjC,aAAa,CAAC7B,IAAD,CAA1B,EAAkC;AAChC;AACAV,MAAAA,mBAAmB,CAAC0E,wBAApB,CAA6C;AAC3CC,QAAAA,aAAa,EAAEzC,sBAAsB,CAACxB,IAAD,CADM;AAE3CkE,QAAAA,WAAW,EAAEC,IAAI,CAACC,SAAL,CAAe;AAC1BN,UAAAA,MAAM,EAAEA;AADkB,SAAf,CAF8B;AAK3C9B,QAAAA,cAAc,EAAEmC,IAAI,CAACC,SAAL,CAAepC,cAAc,CAACqC,IAAf,EAAf;AAL2B,OAA7C;AAOD,KAhB8D,CAgB7D;;;AAGF,QAAIC,YAAY,GAAGtE,IAAI,KAAKsC,SAAS,CAACsB,SAAtC;;AAEA,QAAI;AACF;AACA;AACA;AACA,UAAItB,SAAS,CAACiC,UAAV,GAAuB,CAAvB,IAA4BjC,SAAS,CAACa,MAA1C,EAAkD;AAChDb,QAAAA,SAAS,CAACa,MAAV,CAAiBnD,IAAjB,EAAuB8D,MAAvB;AACD;AACF,KAPD,CAOE,OAAOU,CAAP,EAAU;AACVlF,MAAAA,mBAAmB,CAAC0E,wBAApB,CAA6C;AAC3CC,QAAAA,aAAa,EAAEzC,sBAAsB,CAACxB,IAAD,EAAO,UAAUyE,CAAV,EAAa;AACvD,cAAI5D,MAAM,GAAG,EAAb;;AAEA,cAAI4D,CAAC,KAAKV,aAAV,EAAyB;AACvBlD,YAAAA,MAAM,CAAC6D,IAAP,CAAY,gBAAZ;AACD;;AAED,cAAID,CAAC,KAAKnC,SAAS,CAACqC,UAApB,EAAgC;AAC9B9D,YAAAA,MAAM,CAAC6D,IAAP,CAAY,uBAAZ;AACD;;AAED,cAAID,CAAC,KAAKnC,SAAS,CAACsB,SAApB,EAA+B;AAC7B/C,YAAAA,MAAM,CAAC6D,IAAP,CAAY,sBAAZ;AACD;;AAED,iBAAO7D,MAAP;AACD,SAhBoC,CADM;AAkB3CqD,QAAAA,WAAW,EAAEC,IAAI,CAACC,SAAL,CAAe;AAC1BQ,UAAAA,iBAAiB,EAAEb,aAAa,GAAGA,aAAa,CAACc,QAAjB,GAA4B,IADlC;AAE1BC,UAAAA,WAAW,EAAE9E,IAAI,KAAKsC,SAAS,CAACsB,SAFN;AAG1BU,UAAAA,YAAY,EAAEA,YAHY;AAI1BS,UAAAA,mBAAmB,EAAEzC,SAAS,CAACiC,UAJL;AAK1BS,UAAAA,uBAAuB,EAAE1C,SAAS,CAACqC,UAAV,GAAuBrC,SAAS,CAACqC,UAAV,CAAqBE,QAA5C,GAAuD,IALtD;AAM1BI,UAAAA,qBAAqB,EAAE3C,SAAS,CAACK,YANP;AAO1BuC,UAAAA,sBAAsB,EAAE5C,SAAS,CAACsB,SAAV,GAAsBtB,SAAS,CAACsB,SAAV,CAAoBiB,QAA1C,GAAqD,IAPnD;AAQ1BM,UAAAA,oBAAoB,EAAE7C,SAAS,CAACS,WARN;AAS1BqC,UAAAA,OAAO,EAAEZ,CAAC,GAAG,KAAKA,CAAR,GAAY,IATI;AAU1BV,UAAAA,MAAM,EAAEA;AAVkB,SAAf,EAWV,IAXU,EAWJ,CAXI,CAlB8B;AA8B3C9B,QAAAA,cAAc,EAAEmC,IAAI,CAACC,SAAL,CAAepC,cAAc,CAACqC,IAAf,EAAf,EAAsC,IAAtC,EAA4C,CAA5C;AA9B2B,OAA7C,EADU,CAgCN;AACJ;;AAEA,YAAMG,CAAN;AACD;AACF,GAjED,MAiEO;AACL;AACA;AACA;AACA;AACA;AACA,QAAIxE,IAAI,IAAIsC,SAAS,CAACiC,UAAV,GAAuB,CAAnC,EAAsC;AACpC,UAAIc,KAAK,GAAG/C,SAAS,CAACgD,UAAV,CAAqB,CAArB,CAAZ;AACAD,MAAAA,KAAK,CAACE,MAAN,CAAavF,IAAb,EAAmB8D,MAAnB;AACAxB,MAAAA,SAAS,CAACkD,QAAV,CAAmBH,KAAK,CAACI,UAAN,EAAnB;AACD;AACF;AACF;;AAED,SAAShC,mBAAT,CAA6BnB,SAA7B,EAAwCtC,IAAxC,EAA8C8D,MAA9C,EAAsD9B,cAAtD,EAAsE;AACpE,MAAIqD,KAAK,GAAG3F,0BAA0B,CAACM,IAAD,CAA1B,CAAiC0F,WAAjC,EAAZ,CADoE,CACR;;AAE5D,MAAI5B,MAAM,GAAGjC,aAAa,CAAC7B,IAAD,CAA1B,EAAkC;AAChC;AACAV,IAAAA,mBAAmB,CAAC0E,wBAApB,CAA6C;AAC3CC,MAAAA,aAAa,EAAEzC,sBAAsB,CAACxB,IAAD,CADM;AAE3CkE,MAAAA,WAAW,EAAEC,IAAI,CAACC,SAAL,CAAe;AAC1BN,QAAAA,MAAM,EAAEA;AADkB,OAAf,CAF8B;AAK3C9B,MAAAA,cAAc,EAAEmC,IAAI,CAACC,SAAL,CAAepC,cAAc,CAACqC,IAAf,EAAf;AAL2B,KAA7C;AAOAjF,IAAAA,YAAY,CAACuG,0BAAb;AACD;;AAEDN,EAAAA,KAAK,CAACO,QAAN,CAAe5F,IAAf,EAAqB8D,MAArB,EAfoE,CAetC;;AAE9B,MAAIjE,IAAJ,EAAU;AACR,QAAI;AACFyC,MAAAA,SAAS,CAACkD,QAAV,CAAmBH,KAAnB;AACD,KAFD,CAEE,OAAOb,CAAP,EAAU;AACV,UAAIhE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AACzC;AACAmF,QAAAA,OAAO,CAACC,IAAR,CAAa,gDAAb,EAA+DtB,CAA/D;AACD;AACF;AACF,GATD,MASO;AACLlC,IAAAA,SAAS,CAACkD,QAAV,CAAmBH,KAAnB;AACD;AACF;;AAEDU,MAAM,CAACC,OAAP,GAAiB;AACfjE,EAAAA,uBAAuB,EAAEA,uBADV;AAEf2B,EAAAA,mBAAmB,EAAEA;AAFN,CAAjB","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * \n * @emails oncall+draft_js\n */\n'use strict';\n\nvar DraftEffects = require(\"./DraftEffects\");\n\nvar DraftJsDebugLogging = require(\"./DraftJsDebugLogging\");\n\nvar UserAgent = require(\"fbjs/lib/UserAgent\");\n\nvar containsNode = require(\"fbjs/lib/containsNode\");\n\nvar getActiveElement = require(\"fbjs/lib/getActiveElement\");\n\nvar getCorrectDocumentFromNode = require(\"./getCorrectDocumentFromNode\");\n\nvar invariant = require(\"fbjs/lib/invariant\");\n\nvar isElement = require(\"./isElement\");\n\nvar isIE = UserAgent.isBrowser('IE');\n\nfunction getAnonymizedDOM(node, getNodeLabels) {\n  if (!node) {\n    return '[empty]';\n  }\n\n  var anonymized = anonymizeTextWithin(node, getNodeLabels);\n\n  if (anonymized.nodeType === Node.TEXT_NODE) {\n    return anonymized.textContent;\n  }\n\n  !isElement(anonymized) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Node must be an Element if it is not a text node.') : invariant(false) : void 0;\n  var castedElement = anonymized;\n  return castedElement.outerHTML;\n}\n\nfunction anonymizeTextWithin(node, getNodeLabels) {\n  var labels = getNodeLabels !== undefined ? getNodeLabels(node) : [];\n\n  if (node.nodeType === Node.TEXT_NODE) {\n    var length = node.textContent.length;\n    return getCorrectDocumentFromNode(node).createTextNode('[text ' + length + (labels.length ? ' | ' + labels.join(', ') : '') + ']');\n  }\n\n  var clone = node.cloneNode();\n\n  if (clone.nodeType === 1 && labels.length) {\n    clone.setAttribute('data-labels', labels.join(', '));\n  }\n\n  var childNodes = node.childNodes;\n\n  for (var ii = 0; ii < childNodes.length; ii++) {\n    clone.appendChild(anonymizeTextWithin(childNodes[ii], getNodeLabels));\n  }\n\n  return clone;\n}\n\nfunction getAnonymizedEditorDOM(node, getNodeLabels) {\n  // grabbing the DOM content of the Draft editor\n  var currentNode = node; // this should only be used after checking with isElement\n\n  var castedNode = currentNode;\n\n  while (currentNode) {\n    if (isElement(currentNode) && castedNode.hasAttribute('contenteditable')) {\n      // found the Draft editor container\n      return getAnonymizedDOM(currentNode, getNodeLabels);\n    } else {\n      currentNode = currentNode.parentNode;\n      castedNode = currentNode;\n    }\n  }\n\n  return 'Could not find contentEditable parent of node';\n}\n\nfunction getNodeLength(node) {\n  return node.nodeValue === null ? node.childNodes.length : node.nodeValue.length;\n}\n/**\n * In modern non-IE browsers, we can support both forward and backward\n * selections.\n *\n * Note: IE10+ supports the Selection object, but it does not support\n * the `extend` method, which means that even in modern IE, it's not possible\n * to programatically create a backward selection. Thus, for all IE\n * versions, we use the old IE API to create our selections.\n */\n\n\nfunction setDraftEditorSelection(selectionState, node, blockKey, nodeStart, nodeEnd) {\n  // It's possible that the editor has been removed from the DOM but\n  // our selection code doesn't know it yet. Forcing selection in\n  // this case may lead to errors, so just bail now.\n  var documentObject = getCorrectDocumentFromNode(node);\n\n  if (!containsNode(documentObject.documentElement, node)) {\n    return;\n  }\n\n  var selection = documentObject.defaultView.getSelection();\n  var anchorKey = selectionState.getAnchorKey();\n  var anchorOffset = selectionState.getAnchorOffset();\n  var focusKey = selectionState.getFocusKey();\n  var focusOffset = selectionState.getFocusOffset();\n  var isBackward = selectionState.getIsBackward(); // IE doesn't support backward selection. Swap key/offset pairs.\n\n  if (!selection.extend && isBackward) {\n    var tempKey = anchorKey;\n    var tempOffset = anchorOffset;\n    anchorKey = focusKey;\n    anchorOffset = focusOffset;\n    focusKey = tempKey;\n    focusOffset = tempOffset;\n    isBackward = false;\n  }\n\n  var hasAnchor = anchorKey === blockKey && nodeStart <= anchorOffset && nodeEnd >= anchorOffset;\n  var hasFocus = focusKey === blockKey && nodeStart <= focusOffset && nodeEnd >= focusOffset; // If the selection is entirely bound within this node, set the selection\n  // and be done.\n\n  if (hasAnchor && hasFocus) {\n    selection.removeAllRanges();\n    addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n    addFocusToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    return;\n  }\n\n  if (!isBackward) {\n    // If the anchor is within this node, set the range start.\n    if (hasAnchor) {\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n    } // If the focus is within this node, we can assume that we have\n    // already set the appropriate start range on the selection, and\n    // can simply extend the selection.\n\n\n    if (hasFocus) {\n      addFocusToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    }\n  } else {\n    // If this node has the focus, set the selection range to be a\n    // collapsed range beginning here. Later, when we encounter the anchor,\n    // we'll use this information to extend the selection.\n    if (hasFocus) {\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    } // If this node has the anchor, we may assume that the correct\n    // focus information is already stored on the selection object.\n    // We keep track of it, reset the selection range, and extend it\n    // back to the focus point.\n\n\n    if (hasAnchor) {\n      var storedFocusNode = selection.focusNode;\n      var storedFocusOffset = selection.focusOffset;\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n      addFocusToSelection(selection, storedFocusNode, storedFocusOffset, selectionState);\n    }\n  }\n}\n/**\n * Extend selection towards focus point.\n */\n\n\nfunction addFocusToSelection(selection, node, offset, selectionState) {\n  var activeElement = getActiveElement();\n  var extend = selection.extend; // containsNode returns false if node is null.\n  // Let's refine the type of this value out here so flow knows.\n\n  if (extend && node != null && containsNode(activeElement, node)) {\n    // If `extend` is called while another element has focus, an error is\n    // thrown. We therefore disable `extend` if the active element is somewhere\n    // other than the node we are selecting. This should only occur in Firefox,\n    // since it is the only browser to support multiple selections.\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=921444.\n    // logging to catch bug that is being reported in t16250795\n    if (offset > getNodeLength(node)) {\n      // the call to 'selection.extend' is about to throw\n      DraftJsDebugLogging.logSelectionStateFailure({\n        anonymizedDom: getAnonymizedEditorDOM(node),\n        extraParams: JSON.stringify({\n          offset: offset\n        }),\n        selectionState: JSON.stringify(selectionState.toJS())\n      });\n    } // logging to catch bug that is being reported in t18110632\n\n\n    var nodeWasFocus = node === selection.focusNode;\n\n    try {\n      // Fixes some reports of \"InvalidStateError: Failed to execute 'extend' on\n      // 'Selection': This Selection object doesn't have any Ranges.\"\n      // Note: selection.extend does not exist in IE.\n      if (selection.rangeCount > 0 && selection.extend) {\n        selection.extend(node, offset);\n      }\n    } catch (e) {\n      DraftJsDebugLogging.logSelectionStateFailure({\n        anonymizedDom: getAnonymizedEditorDOM(node, function (n) {\n          var labels = [];\n\n          if (n === activeElement) {\n            labels.push('active element');\n          }\n\n          if (n === selection.anchorNode) {\n            labels.push('selection anchor node');\n          }\n\n          if (n === selection.focusNode) {\n            labels.push('selection focus node');\n          }\n\n          return labels;\n        }),\n        extraParams: JSON.stringify({\n          activeElementName: activeElement ? activeElement.nodeName : null,\n          nodeIsFocus: node === selection.focusNode,\n          nodeWasFocus: nodeWasFocus,\n          selectionRangeCount: selection.rangeCount,\n          selectionAnchorNodeName: selection.anchorNode ? selection.anchorNode.nodeName : null,\n          selectionAnchorOffset: selection.anchorOffset,\n          selectionFocusNodeName: selection.focusNode ? selection.focusNode.nodeName : null,\n          selectionFocusOffset: selection.focusOffset,\n          message: e ? '' + e : null,\n          offset: offset\n        }, null, 2),\n        selectionState: JSON.stringify(selectionState.toJS(), null, 2)\n      }); // allow the error to be thrown -\n      // better than continuing in a broken state\n\n      throw e;\n    }\n  } else {\n    // IE doesn't support extend. This will mean no backward selection.\n    // Extract the existing selection range and add focus to it.\n    // Additionally, clone the selection range. IE11 throws an\n    // InvalidStateError when attempting to access selection properties\n    // after the range is detached.\n    if (node && selection.rangeCount > 0) {\n      var range = selection.getRangeAt(0);\n      range.setEnd(node, offset);\n      selection.addRange(range.cloneRange());\n    }\n  }\n}\n\nfunction addPointToSelection(selection, node, offset, selectionState) {\n  var range = getCorrectDocumentFromNode(node).createRange(); // logging to catch bug that is being reported in t16250795\n\n  if (offset > getNodeLength(node)) {\n    // in this case we know that the call to 'range.setStart' is about to throw\n    DraftJsDebugLogging.logSelectionStateFailure({\n      anonymizedDom: getAnonymizedEditorDOM(node),\n      extraParams: JSON.stringify({\n        offset: offset\n      }),\n      selectionState: JSON.stringify(selectionState.toJS())\n    });\n    DraftEffects.handleExtensionCausedError();\n  }\n\n  range.setStart(node, offset); // IE sometimes throws Unspecified Error when trying to addRange\n\n  if (isIE) {\n    try {\n      selection.addRange(range);\n    } catch (e) {\n      if (process.env.NODE_ENV !== \"production\") {\n        /* eslint-disable-next-line no-console */\n        console.warn('Call to selection.addRange() threw exception: ', e);\n      }\n    }\n  } else {\n    selection.addRange(range);\n  }\n}\n\nmodule.exports = {\n  setDraftEditorSelection: setDraftEditorSelection,\n  addFocusToSelection: addFocusToSelection\n};"]},"metadata":{},"sourceType":"script"}