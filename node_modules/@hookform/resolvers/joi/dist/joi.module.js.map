{"version":3,"file":"joi.module.js","sources":["../src/joi.ts"],"sourcesContent":["import { appendErrors, FieldError } from 'react-hook-form';\nimport { toNestError } from '@hookform/resolvers';\nimport type { ValidationError } from 'joi';\nimport { Resolver } from './types';\n\nconst parseErrorSchema = (\n  error: ValidationError,\n  validateAllFieldCriteria: boolean,\n) =>\n  error.details.length\n    ? error.details.reduce<Record<string, FieldError>>((previous, error) => {\n        const _path = error.path.join('.');\n\n        if (!previous[_path]) {\n          previous[_path] = { message: error.message, type: error.type };\n        }\n\n        if (validateAllFieldCriteria) {\n          const types = previous[_path].types;\n          const messages = types && types[error.type!];\n\n          previous[_path] = appendErrors(\n            _path,\n            validateAllFieldCriteria,\n            previous,\n            error.type,\n            messages\n              ? ([] as string[]).concat(messages as string[], error.message)\n              : error.message,\n          ) as FieldError;\n        }\n\n        return previous;\n      }, {})\n    : {};\n\nexport const joiResolver: Resolver =\n  (\n    schema,\n    schemaOptions = {\n      abortEarly: false,\n    },\n    resolverOptions = {},\n  ) =>\n  async (values, context, options) => {\n    const _schemaOptions = Object.assign({}, schemaOptions, {\n      context,\n    });\n\n    let result: Record<string, any> = {};\n    if (resolverOptions.mode === 'sync') {\n      result = schema.validate(values, _schemaOptions);\n    } else {\n      try {\n        result.value = await schema.validateAsync(values, _schemaOptions);\n      } catch (e) {\n        result.error = e;\n      }\n    }\n\n    return {\n      values: result.error ? {} : result.value,\n      errors: result.error\n        ? toNestError(\n            parseErrorSchema(\n              result.error,\n              !options.shouldUseNativeValidation &&\n                options.criteriaMode === 'all',\n            ),\n            options,\n          )\n        : {},\n    };\n  };\n"],"names":["joiResolver","schema","schemaOptions","resolverOptions","abortEarly","values","context","options","result","error","value","errors","toNestError","validateAllFieldCriteria","shouldUseNativeValidation","criteriaMode","details","length","reduce","previous","_path","path","join","message","type","types","messages","appendErrors","concat","_schemaOptions","Object","assign","mode","validate","validateAsync","e"],"mappings":"iGAKA,IA+BaA,EACX,SACEC,EACAC,EAGAC,mBAHAD,IAAAA,EAAgB,CACdE,YAAY,aAEdD,IAAAA,EAAkB,aAEbE,EAAQC,EAASC,wBAgBtB,MAAO,CACLF,OAAQG,EAAOC,MAAQ,GAAKD,EAAOE,MACnCC,OAAQH,EAAOC,MACXG,GAzDRH,EA2DYD,EAAOC,MA1DnBI,GA2DaN,EAAQO,2BACkB,QAAzBP,EAAQQ,aA1DtBN,EAAMO,QAAQC,OACVR,EAAMO,QAAQE,OAAmC,SAACC,EAAUV,GAC1D,IAAMW,EAAQX,EAAMY,KAAKC,KAAK,KAM9B,GAJKH,EAASC,KACZD,EAASC,GAAS,CAAEG,QAASd,EAAMc,QAASC,KAAMf,EAAMe,OAGtDX,EAA0B,CAC5B,IAAMY,EAAQN,EAASC,GAAOK,MACxBC,EAAWD,GAASA,EAAMhB,EAAMe,MAEtCL,EAASC,GAASO,EAChBP,EACAP,EACAM,EACAV,EAAMe,KACNE,EACK,GAAgBE,OAAOF,EAAsBjB,EAAMc,SACpDd,EAAMc,SAId,OAAOJ,GACN,IACH,IAmCMZ,GAEF,IAlEe,IACvBE,EACAI,GAsCQgB,EAAiBC,OAAOC,OAAO,GAAI7B,EAAe,CACtDI,QAAAA,IAGEE,EAA8B,mBACL,SAAzBL,EAAgB6B,KAClBxB,EAASP,EAAOgC,SAAS5B,EAAQwB,sIAGV5B,EAAOiC,cAAc7B,EAAQwB,qBAAlDrB,EAAOE,oBACAyB,GACP3B,EAAOC,MAAQ0B,iGAnBrB"}